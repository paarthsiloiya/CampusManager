{% extends "base.html" %} {% block content %}
<div class="container mx-auto">
    <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold">My Class Schedule</h2>
        <a href="{{ url_for('views.teacher_dashboard') }}" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100 bg-white">Back to Dashboard</a>
    </div>

    <!-- Flashed Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %} {% if messages %} {% for category, message in messages %}
    <div class="p-4 mb-4 rounded-lg {% if category == 'error' %}bg-red-100 text-red-700{% else %}bg-green-100 text-green-700{% endif %}">{{ message }}</div>
    {% endfor %} {% endif %} {% endwith %}

    <!-- Semester Toggle -->
    <div class="flex justify-center mb-6">
        <div class="inline-flex rounded-lg shadow-sm border border-gray-300 bg-white p-1" role="group">
            <a href="{{ url_for('views.teacher_schedule', group='odd') }}" class="px-6 py-2 text-sm font-medium rounded-md transition-colors {{ 'bg-blue-600 text-white shadow-sm' if current_group == 'odd' else 'text-gray-700 hover:bg-gray-100' }}">
                <div class="flex items-center gap-2">
                    <i data-feather="calendar" class="w-4 h-4"></i>
                    Odd Semester
                </div>
            </a>
            <a href="{{ url_for('views.teacher_schedule', group='even') }}" class="px-6 py-2 text-sm font-medium rounded-md transition-colors {{ 'bg-blue-600 text-white shadow-sm' if current_group == 'even' else 'text-gray-700 hover:bg-gray-100' }}">
                <div class="flex items-center gap-2">
                    <i data-feather="calendar" class="w-4 h-4"></i>
                    Even Semester
                </div>
            </a>
        </div>
    </div>

    {% if periods %}
    <div class="bg-white shadow-lg rounded-xl overflow-hidden">
        <div class="bg-primary-700 bg-darkblue text-white p-4 text-center">
            <h4 class="text-xl font-bold">Weekly Timetable</h4>
        </div>
        <div class="overflow-x-auto">
            <table class="w-full table-auto border-collapse">
                <thead>
                    <tr class="bg-gray-50">
                        <th class="border border-gray-200 p-3 min-w-[100px] text-gray-600">Day</th>
                        {% for p in periods %} {% if loop.index == lunch_break_after + 1 %}
                        <th class="border border-gray-200 p-3 bg-gray-100 min-w-[40px] text-gray-500">Break</th>
                        {% endif %}
                        <th class="border border-gray-200 p-3">
                            <div class="font-bold">Period {{ p }}</div>
                            <span class="text-xs text-gray-500 font-normal bg-gray-200 px-2 py-0.5 rounded-full">{{ period_headers[p] if period_headers else '' }}</span>
                            {% if period_duration_mins %}
                            <div class="mt-1">
                                <span class="text-[0.65rem] text-gray-400 bg-gray-100 px-1.5 py-0.5 rounded border border-gray-200">{{ period_duration_mins }}m</span>
                            </div>
                            {% endif %}
                        </th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for day in days %} {% set is_first_day = loop.first %}
                    <tr>
                        <th class="border border-gray-200 p-3 bg-gray-50 text-left font-medium text-gray-700">{{ day }}</th>
                        {% for p in periods %} {% if loop.index == lunch_break_after + 1 %} {% if is_first_day %}
                        <td rowspan="{{ days|length }}" class="border border-gray-200 bg-gray-50 text-gray-400 font-bold text-center align-middle select-none" style="writing-mode: vertical-rl; transform: rotate(180deg); letter-spacing: 0.2rem">LUNCH BREAK</td>
                        {% endif %} {% endif %} {% set entry = grid[day].get(p) %}
                        <td class="border border-gray-200 p-2 text-center h-24 whitespace-normal min-w-[140px] hover:bg-gray-50 transition">
                            {% if entry %}
                            <div class="font-bold text-sm text-blue-800">{{ entry.assigned_class.subject.name }}</div>

                            <div class="flex flex-wrap gap-1 justify-center mt-2">
                                <span class="text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded border border-blue-200 font-medium"> {{ entry.branch }} </span>
                                <span class="text-xs bg-purple-100 text-purple-800 px-2 py-0.5 rounded border border-purple-200 font-medium"> Sem {{ entry.semester }} </span>
                            </div>
                            <div class="text-xs text-gray-500 mt-1">({{ entry.assigned_class.subject.code }})</div>
                            {% else %}
                            <!-- Blank cell for free period -->
                            <span class="block w-full h-full"></span>
                            {% endif %}
                        </td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% else %}
    <div class="bg-yellow-50 text-yellow-800 p-6 rounded-lg text-center border border-yellow-200">
        <p class="font-bold text-lg mb-2">No Timetable Available</p>
        <p>Your class schedule has not been generated yet. Please contact the administrator.</p>
    </div>
    {% endif %}
</div>
{% endblock %}
