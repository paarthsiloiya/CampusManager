{% extends "base.html" %}
{% block title %}Settings â€” CampusManager{% endblock %}
{% block content %}
    <section class="max-w-4xl mx-auto space-y-8">
        <!-- Header -->
        <div class="flex items-end justify-between">
            <div>
                <h1 class="text-2xl font-bold text-text-dark">Settings</h1>
                <p class="text-text-light mt-1">Manage your profile and account preferences</p>
            </div>
        </div>
        <!-- Personal & Professional Information Form -->
        <form id="profileForm"
              method="post"
              action="{{ url_for("views.settings") }}"
              class="space-y-8">
            <!-- Personal Information -->
            <div class="bg-white rounded-3xl border border-gray-100 shadow-sm overflow-hidden">
                <div class="p-8 border-b border-gray-100">
                    <h2 class="text-xl font-bold text-text-dark flex items-center gap-3">
                        <span class="w-10 h-10 rounded-xl bg-primary/10 text-primary flex items-center justify-center">
                            <i data-feather="user" class="w-5 h-5"></i>
                        </span>
                        Personal Information
                    </h2>
                </div>
                <div class="p-8 space-y-8">
                    <!-- Avatar -->
                    <div class="flex items-center gap-6">
                        <div class="relative group">
                            <div class="w-24 h-24 rounded-full bg-gray-100 flex items-center justify-center text-text-light border-4 border-white shadow-lg overflow-hidden">
                                {% if teacher.profile_pic %}
                                    <img src="{{ teacher.profile_pic }}"
                                         alt="Profile"
                                         width="96" height="96"
                                         class="w-full h-full object-cover" />
                                {% else %}
                                    <i data-feather="user" class="w-10 h-10"></i>
                                {% endif %}
                            </div>
                            <button type="button"
                                    class="absolute bottom-0 right-0 w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center border-2 border-white shadow-sm hover:scale-110 transition-transform">
                                <i data-feather="camera" class="w-4 h-4"></i>
                            </button>
                        </div>
                        <div>
                            <h3 class="font-bold text-text-dark">Profile Photo</h3>
                            <p class="text-xs text-text-light mt-1">Update your profile picture.</p>
                            <p class="text-xs text-text-lighter mt-2">Allowed: JPG, PNG. Max 2MB.</p>
                        </div>
                    </div>
                    <!-- Fields -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="space-y-2">
                            <label class="text-xs font-bold text-text-light uppercase tracking-wide">Full Name</label>
                            <div class="relative">
                                <input value="{{ teacher.name or '' }}"
                                       class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-text-light font-medium cursor-not-allowed focus:outline-none"
                                       readonly />
                                <i data-feather="lock"
                                   class="w-4 h-4 text-gray-400 absolute right-4 top-3.5"></i>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <label class="text-xs font-bold text-text-light uppercase tracking-wide">Email Address</label>
                            <div class="relative">
                                <input value="{{ teacher.email or '' }}"
                                       class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-text-light font-medium cursor-not-allowed focus:outline-none"
                                       readonly />
                                <i data-feather="lock"
                                   class="w-4 h-4 text-gray-400 absolute right-4 top-3.5"></i>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <label for="phone"
                                   class="text-xs font-bold text-text-dark uppercase tracking-wide">
                                Phone Number
                            </label>
                            <input id="phone"
                                   name="phone"
                                   value="{{ teacher.phone or '' }}"
                                   placeholder="+91 ..."
                                   class="w-full bg-white border border-gray-200 rounded-xl px-4 py-3 text-text-dark font-medium focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all" />
                        </div>
                        <div class="space-y-2">
                            <label for="dob"
                                   class="text-xs font-bold text-text-dark uppercase tracking-wide">
                                Date of Birth
                            </label>
                            <input id="dob"
                                   name="date_of_birth"
                                   type="date"
                                   value="{{ teacher.date_of_birth or '' }}"
                                   class="w-full bg-white border border-gray-200 rounded-xl px-4 py-3 text-text-dark font-medium focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all" />
                        </div>
                    </div>
                </div>
            </div>
            <!-- Professional Information -->
            <div class="bg-white rounded-3xl border border-gray-100 shadow-sm overflow-hidden">
                <div class="p-8 border-b border-gray-100">
                    <h2 class="text-xl font-bold text-text-dark flex items-center gap-3">
                        <span class="w-10 h-10 rounded-xl bg-indigo-50 text-indigo-500 flex items-center justify-center">
                            <i data-feather="briefcase" class="w-5 h-5"></i>
                        </span>
                        Professional Information
                    </h2>
                </div>
                <div class="p-8 grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="space-y-2">
                        <label class="text-xs font-bold text-text-light uppercase tracking-wide">Department</label>
                        <div class="relative">
                            <input value="{{ teacher.department or 'Not Assigned' }}"
                                   class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-text-light font-medium cursor-not-allowed focus:outline-none"
                                   readonly />
                            <i data-feather="lock"
                               class="w-4 h-4 text-gray-400 absolute right-4 top-3.5"></i>
                        </div>
                    </div>
                    <div class="space-y-2">
                        <label class="text-xs font-bold text-text-dark uppercase tracking-wide">Institution</label>
                        <div class="relative">
                            <input id="institution"
                                   name="institution"
                                   value="{{ teacher.institution or 'Delhi Technical Campus' }}"
                                   class="w-full bg-white border border-gray-200 rounded-xl px-4 py-3 text-text-dark font-medium focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all" />
                        </div>
                    </div>
                </div>
            </div>
            <!-- Actions -->
            <div class="flex items-center justify-end gap-4">
                <button type="button"
                        onclick="window.location.reload()"
                        class="px-6 py-3 rounded-xl text-text-light font-bold hover:bg-gray-100 transition-colors">
                    Discard
                </button>
                <button type="submit"
                        class="px-8 py-3 rounded-xl bg-primary text-white font-bold shadow-lg shadow-primary/20 hover:scale-105 transition-transform">
                    Save Changes
                </button>
            </div>
        </form>
        <!-- Security Section (Separate Form) -->
        <div class="bg-white rounded-3xl border border-gray-100 shadow-sm overflow-hidden">
            <div class="p-8 border-b border-gray-100">
                <h2 class="text-xl font-bold text-text-dark flex items-center gap-3">
                    <span class="w-10 h-10 rounded-xl bg-emerald-50 text-emerald-600 flex items-center justify-center">
                        <i data-feather="shield" class="w-5 h-5"></i>
                    </span>
                    Security
                </h2>
            </div>
            <div class="p-8">
                <form method="post"
                      action="{{ url_for("views.settings") }}"
                      class="max-w-xl space-y-6">
                    <div class="space-y-2">
                        <label class="text-xs font-bold text-text-dark uppercase tracking-wide">Current Password</label>
                        <input type="password"
                               name="current_password"
                               required
                               class="w-full bg-white border border-gray-200 rounded-xl px-4 py-3 text-text-dark font-medium focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all"
                               placeholder="Enter current password" />
                    </div>
                    <div class="grid lg:grid-cols-2 gap-6">
                        <div class="space-y-2">
                            <label class="text-xs font-bold text-text-dark uppercase tracking-wide">New Password</label>
                            <input type="password"
                                   name="new_password"
                                   required
                                   class="w-full bg-white border border-gray-200 rounded-xl px-4 py-3 text-text-dark font-medium focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all"
                                   placeholder="Min. 6 characters" />
                        </div>
                        <div class="space-y-2">
                            <label class="text-xs font-bold text-text-dark uppercase tracking-wide">Confirm Password</label>
                            <input type="password"
                                   name="confirm_password"
                                   required
                                   class="w-full bg-white border border-gray-200 rounded-xl px-4 py-3 text-text-dark font-medium focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all"
                                   placeholder="Re-enter new password" />
                        </div>
                    </div>
                    <div class="flex justify-end pt-2">
                        <button type="submit"
                                class="px-6 py-3 rounded-xl bg-text-dark text-white font-bold hover:bg-black transition-colors shadow-lg shadow-gray-200">
                            Update Password
                        </button>
                    </div>
                </form>
            </div>
        </div>
        <!-- Danger Zone -->
        <div class="bg-red-50/30 rounded-3xl border border-red-100 overflow-hidden">
            <div class="p-8 border-b border-red-100">
                <h2 class="text-xl font-bold text-red-700 flex items-center gap-3">
                    <span class="w-10 h-10 rounded-xl bg-red-100 text-red-600 flex items-center justify-center">
                        <i data-feather="alert-triangle" class="w-5 h-5"></i>
                    </span>
                    Danger Zone
                </h2>
            </div>
            <div class="p-8">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="font-bold text-text-dark">Delete Account</h3>
                        <p class="text-sm text-text-light max-w-md mt-1">
                            Permanently delete your account and all of your content. This action is not reversible, so please continue with caution.
                        </p>
                    </div>
                    <button type="button"
                            onclick="showDeleteConfirmation()"
                            class="px-6 py-3 rounded-xl bg-white border-2 border-red-100 text-red-600 font-bold hover:bg-red-50 hover:border-red-200 transition-colors">
                        Delete Account
                    </button>
                </div>
            </div>
        </div>
    </section>
    <!-- Delete Modal -->
    <div id="deleteModal"
         class="fixed inset-0 bg-gray-900/50 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-3xl shadow-2xl max-w-md w-full overflow-hidden transform transition-all scale-100">
            <div class="p-8 text-center">
                <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6 text-red-600">
                    <i data-feather="alert-octagon" class="w-8 h-8"></i>
                </div>
                <h3 class="text-2xl font-bold text-text-dark mb-2">Delete Account?</h3>
                <p class="text-text-light mb-8">This action cannot be undone. All your data will be permanently removed.</p>
                <div class="space-y-4">
                    <div class="relative">
                        <input id="deleteConfirmation"
                               type="text"
                               placeholder='Type "DELETE" to confirm'
                               class="w-full border border-gray-200 rounded-xl px-4 py-3 text-center font-bold focus:outline-none focus:border-red-500 focus:ring-1 focus:ring-red-500 transition-all uppercase" />
                    </div>
                    <form action="{{ url_for("views.delete_account") }}" method="post">
                        <button type="submit"
                                id="confirmDeleteBtn"
                                disabled
                                class="w-full bg-red-600 text-white font-bold py-3.5 rounded-xl hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg shadow-red-600/20">
                            Yes, Delete My Account
                        </button>
                    </form>
                    <button type="button"
                            onclick="hideDeleteConfirmation()"
                            class="text-text-light font-bold text-sm hover:text-text-dark transition-colors">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>
    <script>
    document.addEventListener("DOMContentLoaded", function () {
        if (typeof feather !== "undefined") {
            feather.replace();
        }
    });

    // Delete Modal Logic
    const deleteInput = document.getElementById("deleteConfirmation");
    const deleteBtn = document.getElementById("confirmDeleteBtn");
    const deleteModal = document.getElementById("deleteModal");

    if (deleteInput && deleteBtn) {
        deleteInput.addEventListener("input", function () {
            if (this.value.trim().toUpperCase() === "DELETE") {
                deleteBtn.disabled = false;
                deleteBtn.classList.remove("disabled:bg-gray-400", "disabled:cursor-not-allowed");
            } else {
                deleteBtn.disabled = true;
                deleteBtn.classList.add("disabled:bg-gray-400", "disabled:cursor-not-allowed");
            }
        });
    }

    function showDeleteConfirmation() {
        if (deleteModal) {
            deleteModal.classList.remove("hidden");
            deleteModal.classList.add("flex");
            // Simple animation
            setTimeout(() => {
                const innerDiv = deleteModal.querySelector("div");
                if (innerDiv) {
                    innerDiv.classList.remove("scale-95", "opacity-0");
                    innerDiv.classList.add("scale-100", "opacity-100");
                }
            }, 10);

            // Focus input
            if (deleteInput) setTimeout(() => deleteInput.focus(), 100);
        }
    }

    function hideDeleteConfirmation() {
        if (deleteModal) {
            deleteModal.classList.add("hidden");
            deleteModal.classList.remove("flex");
            if (deleteInput) deleteInput.value = "";
            if (deleteBtn) {
                deleteBtn.disabled = true;
                deleteBtn.classList.add("disabled:bg-gray-400", "disabled:cursor-not-allowed");
            }
        }
    }

    // Close modal when clicking outside
    if (deleteModal) {
        deleteModal.addEventListener("click", function (e) {
            if (e.target === this) {
                hideDeleteConfirmation();
            }
        });
    }

    // Close modal with Escape key
    document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") {
            hideDeleteConfirmation();
        }
    });
    </script>
{% endblock %}
